function gestionarXml(a){xmlDoc=a.responseXML,mostrarTitulos(),mostrarPreguntas()}function mostrarTitulos(){ntitulos=xmlDoc.getElementsByTagName("title").length;for(var a=0;a<ntitulos;a++)titulos[a]=xmlDoc.getElementsByTagName("title")[a].innerHTML,tipos[a]=xmlDoc.getElementsByTagName("type")[a].innerHTML,document.getElementsByTagName("form")[0].innerHTML+="<h3>"+titulos[a]+"</h3><div></div>"}function inicializarPregunta(){opciones=[],respuestas=[]}function inicializarNSeleccionadas(){nseleccionadas=0}function inicializarNRespuestas(){nrespuestas_correctas=0,nrespuestas_incorrectas=0}function inicializarNAcertadas(){npreguntas_acertadas=0}function inicializarNVacias(){nvacias=0}function identificadorPregunta(){identificador=pregunta<10?"jklm_00"+pregunta:"jklm_0"+pregunta}function mostrarPreguntas(){for(var a=0;a<ntitulos;a++){switch(pregunta=a+1,identificadorPregunta(),tipos[a]){case"radio":preguntaRadio();break;case"text":preguntaTexto();break;case"checkbox":preguntaCheckbox();break;case"select":preguntaSelect();break;case"multiple":preguntaSelectMultiple();break;default:window.alert("Tipo de pregunta no clasificada.")}switch(pregunta){case 1:opciones_01=opciones,respuestas_01=respuestas;break;case 2:opciones_02=opciones,respuestas_02=respuestas;break;case 3:opciones_03=opciones,respuestas_03=respuestas;break;case 4:opciones_04=opciones,respuestas_04=respuestas;break;case 5:opciones_05=opciones,respuestas_05=respuestas;break;case 6:opciones_06=opciones,respuestas_06=respuestas;break;case 7:opciones_07=opciones,respuestas_07=respuestas;break;case 8:opciones_08=opciones,respuestas_08=respuestas;break;case 9:opciones_09=opciones,respuestas_09=respuestas;break;case 10:opciones_10=opciones,respuestas_10=respuestas;break;case 11:opciones_11=opciones,respuestas_11=respuestas;break;case 12:opciones_12=opciones,respuestas_12=respuestas;break;case 13:opciones_13=opciones,respuestas_13=respuestas;break;default:window.alert("Número de pregunta incorrecto.")}}}function preguntaRadio(){inicializarPregunta();for(var a=xmlDoc.getElementById(identificador).getElementsByTagName("option").length,b=0;b<a;b++)opciones[b]=xmlDoc.getElementById(identificador).getElementsByTagName("option")[b].innerHTML,document.getElementsByTagName("div")[pregunta-1].innerHTML+="<input type='radio' id = '"+identificador+"_"+b+"' name="+identificador+" value='"+b+"'><label for = '"+identificador+"_"+b+"'>"+opciones[b]+"</label><br>";for(var c=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,b=0;b<c;b++)respuestas[b]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[b].innerHTML}function preguntaTexto(){inicializarPregunta(),opciones=[],document.getElementsByTagName("div")[pregunta-1].innerHTML+="Respuesta: <input type='text' name="+identificador+"><br>";for(var a=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,b=0;b<a;b++)respuestas[b]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[b].innerHTML}function preguntaCheckbox(){inicializarPregunta();for(var a=xmlDoc.getElementById(identificador).getElementsByTagName("option").length,b=0;b<a;b++)opciones[b]=xmlDoc.getElementById(identificador).getElementsByTagName("option")[b].innerHTML,document.getElementsByTagName("div")[pregunta-1].innerHTML+="<input type='checkbox' id = '"+identificador+"_"+b+"' name="+identificador+" value='"+b+"'><label for = '"+identificador+"_"+b+"'>"+opciones[b]+"</label><br>";for(var c=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,b=0;b<c;b++)respuestas[b]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[b].innerHTML}function preguntaSelect(){inicializarPregunta();var a=xmlDoc.getElementById(identificador).getElementsByTagName("option").length,b=document.createElement("select");b.name=identificador;for(var c=0;c<a;c++){opciones[c]=xmlDoc.getElementById(identificador).getElementsByTagName("option")[c].innerHTML;var d=document.createElement("option");d.text=opciones[c],d.value=c,b.options.add(d)}c=a,opciones[c]="";var d=document.createElement("option");d.text=opciones[c],d.value=opciones[c],d.setAttribute("selected","selected"),b.options.add(d),document.getElementsByTagName("div")[pregunta-1].appendChild(b);for(var e=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,c=0;c<e;c++)respuestas[c]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[c].innerHTML}function preguntaSelectMultiple(){inicializarPregunta();var a=xmlDoc.getElementById(identificador).getElementsByTagName("option").length,b=document.createElement("select");b.setAttribute("multiple","multiple"),b.name=identificador;for(var c=0;c<a;c++){opciones[c]=xmlDoc.getElementById(identificador).getElementsByTagName("option")[c].innerHTML;var d=document.createElement("option");d.text=opciones[c],d.value=c,b.options.add(d)}document.getElementsByTagName("div")[pregunta-1].appendChild(b);for(var e=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,c=0;c<e;c++)respuestas[c]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[c].innerHTML}function corregirPrevio(){inicializarNAcertadas(),inicializarNVacias();for(var a=0;a<ntitulos;a++){switch(pregunta=a+1,identificadorPregunta(),pregunta){case 1:opciones=opciones_01,respuestas=respuestas_01;break;case 2:opciones=opciones_02,respuestas=respuestas_02;break;case 3:opciones=opciones_03,respuestas=respuestas_03;break;case 4:opciones=opciones_04,respuestas=respuestas_04;break;case 5:opciones=opciones_05,respuestas=respuestas_05;break;case 6:opciones=opciones_06,respuestas=respuestas_06;break;case 7:opciones=opciones_07,respuestas=respuestas_07;break;case 8:opciones=opciones_08,respuestas=respuestas_08;break;case 9:opciones=opciones_09,respuestas=respuestas_09;break;case 10:opciones=opciones_10,respuestas=respuestas_10;break;case 11:opciones=opciones_11,respuestas=respuestas_11;break;case 12:opciones=opciones_12,respuestas=respuestas_12;break;case 13:opciones=opciones_13,respuestas=respuestas_13;break;default:window.alert("Número de pregunta incorrecto.")}switch(tipos[a]){case"radio":opciones=document.getElementsByName(identificador),comprobacionChequeo();break;case"checkbox":opciones=document.getElementsByName(identificador),comprobacionChequeo();break;case"text":opciones=document.getElementsByName(identificador),comprobacionTexto();break;case"select":opciones=document.getElementsByName(identificador)[0].options,comprobacionSeleccion();break;case"multiple":opciones=document.getElementsByName(identificador)[0].options,comprobacionSeleccion();break;default:window.alert("Tipo de pregunta desconocido.")}resolucionPrevia()}}function corregir(){inicializarNAcertadas(),inicializarNVacias();for(var a=0;a<ntitulos;a++){switch(pregunta=a+1,identificadorPregunta(),pregunta){case 1:opciones=opciones_01,respuestas=respuestas_01;break;case 2:opciones=opciones_02,respuestas=respuestas_02;break;case 3:opciones=opciones_03,respuestas=respuestas_03;break;case 4:opciones=opciones_04,respuestas=respuestas_04;break;case 5:opciones=opciones_05,respuestas=respuestas_05;break;case 6:opciones=opciones_06,respuestas=respuestas_06;break;case 7:opciones=opciones_07,respuestas=respuestas_07;break;case 8:opciones=opciones_08,respuestas=respuestas_08;break;case 9:opciones=opciones_09,respuestas=respuestas_09;break;case 10:opciones=opciones_10,respuestas=respuestas_10;break;case 11:opciones=opciones_11,respuestas=respuestas_11;break;case 12:opciones=opciones_12,respuestas=respuestas_12;break;case 13:opciones=opciones_13,respuestas=respuestas_13;break;default:window.alert("Número de pregunta incorrecto.")}switch(tipos[a]){case"radio":opciones=document.getElementsByName(identificador),comprobacionChequeo();break;case"checkbox":opciones=document.getElementsByName(identificador),comprobacionChequeo();break;case"text":opciones=document.getElementsByName(identificador),comprobacionTexto();break;case"select":opciones=document.getElementsByName(identificador)[0].options,comprobacionSeleccion();break;case"multiple":opciones=document.getElementsByName(identificador)[0].options,comprobacionSeleccion();break;default:window.alert("Tipo de pregunta desconocido.")}resolucion()}}function comprobacionSeleccion(){inicializarNSeleccionadas(),inicializarNRespuestas();for(var a=0;a<opciones.length;a++){opciones[a].selected&&""!=opciones[a].value&&nseleccionadas++;for(var b=0;b<respuestas.length;b++)opciones[a].selected&&opciones[a].value==respuestas[b]&&nrespuestas_correctas++}nrespuestas_incorrectas=nseleccionadas-nrespuestas_correctas}function comprobacionChequeo(){inicializarNSeleccionadas(),inicializarNRespuestas();for(var a=0;a<opciones.length;a++){opciones[a].checked&&""!=opciones[a].value&&nseleccionadas++;for(var b=0;b<respuestas.length;b++)opciones[a].checked&&opciones[a].value==respuestas[b]&&nrespuestas_correctas++}nrespuestas_incorrectas=nseleccionadas-nrespuestas_correctas}function comprobacionTexto(){inicializarNSeleccionadas(),inicializarNRespuestas();for(var a=0;a<opciones.length;a++){""!=opciones[a].value&&nseleccionadas++;for(var b=0;b<respuestas.length;b++)opciones[a].value==respuestas[b]&&nrespuestas_correctas++}nrespuestas_incorrectas=nseleccionadas-nrespuestas_correctas}function resolucionPrevia(){0==nrespuestas_correctas&&0==nrespuestas_incorrectas&&(document.getElementsByTagName("h3")[pregunta-1].innerHTML+=vacio,nvacias++)}function resolucion(){0==nrespuestas_correctas&&0==nrespuestas_incorrectas?(document.getElementsByTagName("h3")[pregunta-1].innerHTML+=vacio,nvacias++):nrespuestas_correctas==respuestas.length&&0==nrespuestas_incorrectas?(document.getElementsByTagName("h3")[pregunta-1].innerHTML+=visto_verde,npreguntas_acertadas++):document.getElementsByTagName("h3")[pregunta-1].innerHTML+=aspa_roja+"</br><span>Aciertos "+nrespuestas_correctas+"/"+respuestas.length+". Fallos "+nrespuestas_incorrectas+".</span>"}function notaFinal(){nota=npreguntas_acertadas/ntitulos*10,document.getElementById("nota").innerHTML=nota.toFixed(1),npreguntas_acertadas==ntitulos&&(aux=!1,clearInterval(interval),window.alert("Enhorabuena, ¡has acertado todas las preguntas del test de historia!"))}function reponerTitulos(){for(var a=0;a<ntitulos;a++)document.getElementsByTagName("h3")[a].innerHTML=titulos[a]}function reponerNota(){document.getElementById("nota").innerHTML="nota"}function temporizador(a,b,c,d){aux=!0,interval=setInterval(function(){d>0?d--:c>0?(c--,d=59):b>0?(b--,c=59,d=59):a>0?(a--,b=24,c=59,d=59):clearInterval(interval),document.getElementById("tiempo").innerHTML=c+"m "+d+" s",0==a&&0==b&&0==c&&0==d&&aux&&(aux=!1,window.alert("Oh, ¡se te acabó el tiempo sin haber podido acertar todas las preguntas!"),window.alert("Si quieres volver a intentarlo, ¡COMIENZA DE NUEVO!"))},1e3)}var xmlDoc,formElement=null,aux,interval,dias=0,horas=0,minutos=5,segundos=0,titulos=[],ntitulos,tipos=[],pregunta,identificador,opciones=[],opciones_01=[],opciones_02=[],opciones_03=[],opciones_04=[],opciones_05=[],opciones_06=[],opciones_07=[],opciones_08=[],opciones_09=[],opciones_10=[],opciones_11=[],opciones_12=[],opciones_13=[],respuestas=[],respuestas_01=[],respuestas_02=[],respuestas_03=[],respuestas_04=[],respuestas_05=[],respuestas_06=[],respuestas_07=[],respuestas_08=[],respuestas_09=[],respuestas_10=[],respuestas_11=[],respuestas_12=[],respuestas_13=[],nvacias,nseleccionadas,nrespuestas_correctas,nrespuestas_incorrectas,npreguntas_acertadas,vacio="</br><span>No has introducido o seleccionado ninguna respuesta.</span>",visto_verde=" <img src='img/visto_verde_20px.png'/>",aspa_roja=" <img src='img/aspa_roja_20px.png'/>",nota;window.onload=function(){var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&200==this.status&&gestionarXml(this)},a.open("GET","xml/preguntas.xml",!0),a.send(),temporizador(dias,horas,minutos,segundos),formElement=document.getElementById("myform"),formElement.onsubmit=function(){return aux?(reponerTitulos(),reponerNota(),corregirPrevio(),0==nvacias?(corregir(),notaFinal()):window.alert("Tienes preguntas sin responder todavía.")):window.alert("¡COMIENZA DE NUEVO!"),!1},formElement.onreset=function(){location.reload()}},window.onmousedown=function(a){var b=a.target;if("option"==b.tagName.toLowerCase()&&b.parentNode.hasAttribute("multiple")){a.preventDefault(),b.hasAttribute("selected")?b.removeAttribute("selected"):b.setAttribute("selected","");var c=b.parentNode.cloneNode(!0);b.parentNode.parentNode.replaceChild(c,b.parentNode)}};