function gestionarXml(e){xmlDoc=e.responseXML,mostrarTitulos(),mostrarPreguntas()}function mostrarTitulos(){ntitulos=xmlDoc.getElementsByTagName("title").length;for(var e=0;ntitulos>e;e++)titulos[e]=xmlDoc.getElementsByTagName("title")[e].innerHTML,tipos[e]=xmlDoc.getElementsByTagName("type")[e].innerHTML,document.getElementsByTagName("form")[0].innerHTML+="<h3>"+titulos[e]+"</h3><div></div>"}function inicializarPregunta(){opciones=[],respuestas=[]}function inicializarNSeleccionadas(){nseleccionadas=0}function inicializarNRespuestas(){nrespuestas_correctas=0,nrespuestas_incorrectas=0}function inicializarNAcertadas(){npreguntas_acertadas=0}function inicializarNVacias(){nvacias=0}function identificadorPregunta(){identificador=10>pregunta?"jklm_00"+pregunta:"jklm_0"+pregunta}function mostrarPreguntas(){for(var e=0;ntitulos>e;e++){switch(pregunta=e+1,identificadorPregunta(),tipos[e]){case"radio":preguntaRadio();break;case"text":preguntaTexto();break;case"checkbox":preguntaCheckbox();break;case"select":preguntaSelect();break;case"multiple":preguntaSelectMultiple();break;default:window.alert("Tipo de pregunta no clasificada.")}switch(pregunta){case 1:opciones_01=opciones,respuestas_01=respuestas;break;case 2:opciones_02=opciones,respuestas_02=respuestas;break;case 3:opciones_03=opciones,respuestas_03=respuestas;break;case 4:opciones_04=opciones,respuestas_04=respuestas;break;case 5:opciones_05=opciones,respuestas_05=respuestas;break;case 6:opciones_06=opciones,respuestas_06=respuestas;break;case 7:opciones_07=opciones,respuestas_07=respuestas;break;case 8:opciones_08=opciones,respuestas_08=respuestas;break;case 9:opciones_09=opciones,respuestas_09=respuestas;break;case 10:opciones_10=opciones,respuestas_10=respuestas;break;case 11:opciones_11=opciones,respuestas_11=respuestas;break;case 12:opciones_12=opciones,respuestas_12=respuestas;break;case 13:opciones_13=opciones,respuestas_13=respuestas;break;default:window.alert("Número de pregunta incorrecto.")}}}function preguntaRadio(){inicializarPregunta();for(var e=xmlDoc.getElementById(identificador).getElementsByTagName("option").length,s=0;e>s;s++)opciones[s]=xmlDoc.getElementById(identificador).getElementsByTagName("option")[s].innerHTML,document.getElementsByTagName("div")[pregunta-1].innerHTML+="<input type='radio' id = '"+identificador+"_"+s+"' name="+identificador+" value='"+s+"'><label for = '"+identificador+"_"+s+"'>"+opciones[s]+"</label><br>";for(var a=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,s=0;a>s;s++)respuestas[s]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[s].innerHTML}function preguntaTexto(){inicializarPregunta(),opciones=[],document.getElementsByTagName("div")[pregunta-1].innerHTML+="Respuesta: <input type='text' name="+identificador+"><br>";for(var e=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,s=0;e>s;s++)respuestas[s]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[s].innerHTML}function preguntaCheckbox(){inicializarPregunta();for(var e=xmlDoc.getElementById(identificador).getElementsByTagName("option").length,s=0;e>s;s++)opciones[s]=xmlDoc.getElementById(identificador).getElementsByTagName("option")[s].innerHTML,document.getElementsByTagName("div")[pregunta-1].innerHTML+="<input type='checkbox' id = '"+identificador+"_"+s+"' name="+identificador+" value='"+s+"'><label for = '"+identificador+"_"+s+"'>"+opciones[s]+"</label><br>";for(var a=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,s=0;a>s;s++)respuestas[s]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[s].innerHTML}function preguntaSelect(){inicializarPregunta();var e=xmlDoc.getElementById(identificador).getElementsByTagName("option").length,s=document.createElement("select");s.name=identificador;for(var a=0;e>a;a++){opciones[a]=xmlDoc.getElementById(identificador).getElementsByTagName("option")[a].innerHTML;var t=document.createElement("option");t.text=opciones[a],t.value=a,s.options.add(t)}a=e,opciones[a]="";var t=document.createElement("option");t.text=opciones[a],t.value=opciones[a],t.setAttribute("selected","selected"),s.options.add(t),document.getElementsByTagName("div")[pregunta-1].appendChild(s);for(var o=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,a=0;o>a;a++)respuestas[a]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[a].innerHTML}function preguntaSelectMultiple(){inicializarPregunta();var e=xmlDoc.getElementById(identificador).getElementsByTagName("option").length,s=document.createElement("select");s.setAttribute("multiple","multiple"),s.name=identificador;for(var a=0;e>a;a++){opciones[a]=xmlDoc.getElementById(identificador).getElementsByTagName("option")[a].innerHTML;var t=document.createElement("option");t.text=opciones[a],t.value=a,s.options.add(t)}document.getElementsByTagName("div")[pregunta-1].appendChild(s);for(var o=xmlDoc.getElementById(identificador).getElementsByTagName("answer").length,a=0;o>a;a++)respuestas[a]=xmlDoc.getElementById(identificador).getElementsByTagName("answer")[a].innerHTML}function corregirPrevio(){inicializarNAcertadas(),inicializarNVacias();for(var e=0;ntitulos>e;e++){switch(pregunta=e+1,identificadorPregunta(),pregunta){case 1:opciones=opciones_01,respuestas=respuestas_01;break;case 2:opciones=opciones_02,respuestas=respuestas_02;break;case 3:opciones=opciones_03,respuestas=respuestas_03;break;case 4:opciones=opciones_04,respuestas=respuestas_04;break;case 5:opciones=opciones_05,respuestas=respuestas_05;break;case 6:opciones=opciones_06,respuestas=respuestas_06;break;case 7:opciones=opciones_07,respuestas=respuestas_07;break;case 8:opciones=opciones_08,respuestas=respuestas_08;break;case 9:opciones=opciones_09,respuestas=respuestas_09;break;case 10:opciones=opciones_10,respuestas=respuestas_10;break;case 11:opciones=opciones_11,respuestas=respuestas_11;break;case 12:opciones=opciones_12,respuestas=respuestas_12;break;case 13:opciones=opciones_13,respuestas=respuestas_13;break;default:window.alert("Número de pregunta incorrecto.")}switch(tipos[e]){case"radio":opciones=document.getElementsByName(identificador),comprobacionChequeo();break;case"checkbox":opciones=document.getElementsByName(identificador),comprobacionChequeo();break;case"text":opciones=document.getElementsByName(identificador),comprobacionTexto();break;case"select":opciones=document.getElementsByName(identificador)[0].options,comprobacionSeleccion();break;case"multiple":opciones=document.getElementsByName(identificador)[0].options,comprobacionSeleccion();break;default:window.alert("Tipo de pregunta desconocido.")}resolucionPrevia()}}function corregir(){inicializarNAcertadas(),inicializarNVacias();for(var e=0;ntitulos>e;e++){switch(pregunta=e+1,identificadorPregunta(),pregunta){case 1:opciones=opciones_01,respuestas=respuestas_01;break;case 2:opciones=opciones_02,respuestas=respuestas_02;break;case 3:opciones=opciones_03,respuestas=respuestas_03;break;case 4:opciones=opciones_04,respuestas=respuestas_04;break;case 5:opciones=opciones_05,respuestas=respuestas_05;break;case 6:opciones=opciones_06,respuestas=respuestas_06;break;case 7:opciones=opciones_07,respuestas=respuestas_07;break;case 8:opciones=opciones_08,respuestas=respuestas_08;break;case 9:opciones=opciones_09,respuestas=respuestas_09;break;case 10:opciones=opciones_10,respuestas=respuestas_10;break;case 11:opciones=opciones_11,respuestas=respuestas_11;break;case 12:opciones=opciones_12,respuestas=respuestas_12;break;case 13:opciones=opciones_13,respuestas=respuestas_13;break;default:window.alert("Número de pregunta incorrecto.")}switch(tipos[e]){case"radio":opciones=document.getElementsByName(identificador),comprobacionChequeo();break;case"checkbox":opciones=document.getElementsByName(identificador),comprobacionChequeo();break;case"text":opciones=document.getElementsByName(identificador),comprobacionTexto();break;case"select":opciones=document.getElementsByName(identificador)[0].options,comprobacionSeleccion();break;case"multiple":opciones=document.getElementsByName(identificador)[0].options,comprobacionSeleccion();break;default:window.alert("Tipo de pregunta desconocido.")}resolucion()}}function comprobacionSeleccion(){inicializarNSeleccionadas(),inicializarNRespuestas();for(var e=0;e<opciones.length;e++){opciones[e].selected&&""!=opciones[e].value&&nseleccionadas++;for(var s=0;s<respuestas.length;s++)opciones[e].selected&&opciones[e].value==respuestas[s]&&nrespuestas_correctas++}nrespuestas_incorrectas=nseleccionadas-nrespuestas_correctas}function comprobacionChequeo(){inicializarNSeleccionadas(),inicializarNRespuestas();for(var e=0;e<opciones.length;e++){opciones[e].checked&&""!=opciones[e].value&&nseleccionadas++;for(var s=0;s<respuestas.length;s++)opciones[e].checked&&opciones[e].value==respuestas[s]&&nrespuestas_correctas++}nrespuestas_incorrectas=nseleccionadas-nrespuestas_correctas}function comprobacionTexto(){inicializarNSeleccionadas(),inicializarNRespuestas();for(var e=0;e<opciones.length;e++){""!=opciones[e].value&&nseleccionadas++;for(var s=0;s<respuestas.length;s++)opciones[e].value==respuestas[s]&&nrespuestas_correctas++}nrespuestas_incorrectas=nseleccionadas-nrespuestas_correctas}function resolucionPrevia(){0==nrespuestas_correctas&&0==nrespuestas_incorrectas&&(document.getElementsByTagName("h3")[pregunta-1].innerHTML+=vacio,nvacias++)}function resolucion(){0==nrespuestas_correctas&&0==nrespuestas_incorrectas?(document.getElementsByTagName("h3")[pregunta-1].innerHTML+=vacio,nvacias++):nrespuestas_correctas==respuestas.length&&0==nrespuestas_incorrectas?(document.getElementsByTagName("h3")[pregunta-1].innerHTML+=visto_verde,npreguntas_acertadas++):document.getElementsByTagName("h3")[pregunta-1].innerHTML+=aspa_roja+"</br><span>Aciertos "+nrespuestas_correctas+"/"+respuestas.length+". Fallos "+nrespuestas_incorrectas+".</span>"}function notaFinal(){nota=npreguntas_acertadas/ntitulos*10,document.getElementById("nota").innerHTML=nota.toFixed(1),npreguntas_acertadas==ntitulos&&(aux=!1,clearInterval(interval),window.alert("Enhorabuena, ¡has acertado todas las preguntas del test de historia!"))}function reponerTitulos(){for(var e=0;ntitulos>e;e++)document.getElementsByTagName("h3")[e].innerHTML=titulos[e]}function reponerNota(){document.getElementById("nota").innerHTML="nota"}function temporizador(e,s,a,t){aux=!0,interval=setInterval(function(){t>0?t--:a>0?(a--,t=59):s>0?(s--,a=59,t=59):e>0?(e--,s=24,a=59,t=59):clearInterval(interval),document.getElementById("tiempo").innerHTML=a+"m "+t+" s",0==e&&0==s&&0==a&&0==t&&aux&&(aux=!1,window.alert("Oh, ¡se te acabó el tiempo sin haber podido acertar todas las preguntas!"),window.alert("Si quieres volver a intentarlo, ¡COMIENZA DE NUEVO!"))},1e3)}var xmlDoc,formElement=null,aux,interval,dias=0,horas=0,minutos=5,segundos=0,titulos=[],ntitulos,tipos=[],pregunta,identificador,opciones=[],opciones_01=[],opciones_02=[],opciones_03=[],opciones_04=[],opciones_05=[],opciones_06=[],opciones_07=[],opciones_08=[],opciones_09=[],opciones_10=[],opciones_11=[],opciones_12=[],opciones_13=[],respuestas=[],respuestas_01=[],respuestas_02=[],respuestas_03=[],respuestas_04=[],respuestas_05=[],respuestas_06=[],respuestas_07=[],respuestas_08=[],respuestas_09=[],respuestas_10=[],respuestas_11=[],respuestas_12=[],respuestas_13=[],nvacias,nseleccionadas,nrespuestas_correctas,nrespuestas_incorrectas,npreguntas_acertadas,vacio="</br><span>No has introducido o seleccionado ninguna respuesta.</span>",visto_verde=" <img src='img/visto_verde_20px.png'/>",aspa_roja=" <img src='img/aspa_roja_20px.png'/>",nota;window.onload=function(){var e=new XMLHttpRequest;e.onreadystatechange=function(){4==this.readyState&&200==this.status&&gestionarXml(this)},e.open("GET","https://rawgit.com/mnibir/HistoryQuestions/master/xml/preguntas.xml",!0),e.send(),temporizador(dias,horas,minutos,segundos),formElement=document.getElementById("myform"),formElement.onsubmit=function(){return aux?(reponerTitulos(),reponerNota(),corregirPrevio(),0==nvacias?(corregir(),notaFinal()):window.alert("Tienes preguntas sin responder todavía.")):window.alert("¡COMIENZA DE NUEVO!"),!1},formElement.onreset=function(){location.reload()}},window.onmousedown=function(e){var s=e.target;if("option"==s.tagName.toLowerCase()&&s.parentNode.hasAttribute("multiple")){e.preventDefault(),s.hasAttribute("selected")?s.removeAttribute("selected"):s.setAttribute("selected","");var a=s.parentNode.cloneNode(!0);s.parentNode.parentNode.replaceChild(a,s.parentNode)}};